export const zodiacSigns = {
  '白羊座': { start: [3, 21], end: [4, 19], element: '火', guardian: '火星' },
  '金牛座': { start: [4, 20], end: [5, 20], element: '土', guardian: '金星' },
  '双子座': { start: [5, 21], end: [6, 21], element: '风', guardian: '水星' },
  '巨蟹座': { start: [6, 22], end: [7, 22], element: '水', guardian: '月亮' },
  '狮子座': { start: [7, 23], end: [8, 22], element: '火', guardian: '太阳' },
  '处女座': { start: [8, 23], end: [9, 22], element: '土', guardian: '水星' },
  '天秤座': { start: [9, 23], end: [10, 23], element: '风', guardian: '金星' },
  '天蝎座': { start: [10, 24], end: [11, 22], element: '水', guardian: '冥王星' },
  '射手座': { start: [11, 23], end: [12, 21], element: '火', guardian: '木星' },
  '摩羯座': { start: [12, 22], end: [1, 19], element: '土', guardian: '土星' },
  '水瓶座': { start: [1, 20], end: [2, 18], element: '风', guardian: '天王星' },
  '双鱼座': { start: [2, 19], end: [3, 20], element: '水', guardian: '海王星' }
}

export function getZodiacSign(birthDate: string): string {
  const date = new Date(birthDate)
  const month = date.getMonth() + 1
  const day = date.getDate()
  
  for (const [sign, info] of Object.entries(zodiacSigns)) {
    const [startMonth, startDay] = info.start
    const [endMonth, endDay] = info.end
    
    if (startMonth === endMonth) {
      if (month === startMonth && day >= startDay! && day <= endDay!) {
        return sign
      }
    } else {
      if ((month === startMonth && day >= startDay!) || 
          (month === endMonth && day <= endDay!)) {
        return sign
      }
    }
  }
  
  return '未知'
}

const loveCompatibility: Record<string, Record<string, number>> = {
  '白羊座': { '白羊座': 85, '金牛座': 60, '双子座': 75, '巨蟹座': 50, '狮子座': 95, '处女座': 40, '天秤座': 80, '天蝎座': 70, '射手座': 90, '摩羯座': 45, '水瓶座': 85, '双鱼座': 55 },
  '金牛座': { '白羊座': 60, '金牛座': 80, '双子座': 45, '巨蟹座': 85, '狮子座': 50, '处女座': 90, '天秤座': 65, '天蝎座': 75, '射手座': 40, '摩羯座': 95, '水瓶座': 35, '双鱼座': 80 },
  '双子座': { '白羊座': 75, '金牛座': 45, '双子座': 70, '巨蟹座': 40, '狮子座': 80, '处女座': 60, '天秤座': 95, '天蝎座': 55, '射手座': 85, '摩羯座': 35, '水瓶座': 90, '双鱼座': 50 },
  '巨蟹座': { '白羊座': 50, '金牛座': 85, '双子座': 40, '巨蟹座': 75, '狮子座': 60, '处女座': 80, '天秤座': 55, '天蝎座': 95, '射手座': 35, '摩羯座': 70, '水瓶座': 45, '双鱼座': 90 },
  '狮子座': { '白羊座': 95, '金牛座': 50, '双子座': 80, '巨蟹座': 60, '狮子座': 85, '处女座': 45, '天秤座': 90, '天蝎座': 65, '射手座': 95, '摩羯座': 40, '水瓶座': 85, '双鱼座': 55 },
  '处女座': { '白羊座': 40, '金牛座': 90, '双子座': 60, '巨蟹座': 80, '狮子座': 45, '处女座': 75, '天秤座': 65, '天蝎座': 85, '射手座': 35, '摩羯座': 95, '水瓶座': 50, '双鱼座': 70 },
  '天秤座': { '白羊座': 80, '金牛座': 65, '双子座': 95, '巨蟹座': 55, '狮子座': 90, '处女座': 65, '天秤座': 80, '天蝎座': 60, '射手座': 85, '摩羯座': 50, '水瓶座': 95, '双鱼座': 60 },
  '天蝎座': { '白羊座': 70, '金牛座': 75, '双子座': 55, '巨蟹座': 95, '狮子座': 65, '处女座': 85, '天秤座': 60, '天蝎座': 90, '射手座': 50, '摩羯座': 80, '水瓶座': 55, '双鱼座': 95 },
  '射手座': { '白羊座': 90, '金牛座': 40, '双子座': 85, '巨蟹座': 35, '狮子座': 95, '处女座': 35, '天秤座': 85, '天蝎座': 50, '射手座': 80, '摩羯座': 45, '水瓶座': 90, '双鱼座': 60 },
  '摩羯座': { '白羊座': 45, '金牛座': 95, '双子座': 35, '巨蟹座': 70, '狮子座': 40, '处女座': 95, '天秤座': 50, '天蝎座': 80, '射手座': 45, '摩羯座': 85, '水瓶座': 60, '双鱼座': 75 },
  '水瓶座': { '白羊座': 85, '金牛座': 35, '双子座': 90, '巨蟹座': 45, '狮子座': 85, '处女座': 50, '天秤座': 95, '天蝎座': 55, '射手座': 90, '摩羯座': 60, '水瓶座': 80, '双鱼座': 65 },
  '双鱼座': { '白羊座': 55, '金牛座': 80, '双子座': 50, '巨蟹座': 90, '狮子座': 55, '处女座': 70, '天秤座': 60, '天蝎座': 95, '射手座': 60, '摩羯座': 75, '水瓶座': 65, '双鱼座': 85 }
}

const workCompatibility: Record<string, Record<string, number>> = {
  '白羊座': { '白羊座': 60, '金牛座': 75, '双子座': 85, '巨蟹座': 65, '狮子座': 70, '处女座': 80, '天秤座': 90, '天蝎座': 75, '射手座': 85, '摩羯座': 85, '水瓶座': 80, '双鱼座': 70 },
  '金牛座': { '白羊座': 75, '金牛座': 70, '双子座': 65, '巨蟹座': 80, '狮子座': 75, '处女座': 95, '天秤座': 85, '天蝎座': 80, '射手座': 60, '摩羯座': 90, '水瓶座': 55, '双鱼座': 75 },
  '双子座': { '白羊座': 85, '金牛座': 65, '双子座': 75, '巨蟹座': 60, '狮子座': 85, '处女座': 70, '天秤座': 90, '天蝎座': 65, '射手座': 80, '摩羯座': 60, '水瓶座': 95, '双鱼座': 65 },
  '巨蟹座': { '白羊座': 65, '金牛座': 80, '双子座': 60, '巨蟹座': 85, '狮子座': 70, '处女座': 85, '天秤座': 75, '天蝎座': 90, '射手座': 55, '摩羯座': 80, '水瓶座': 65, '双鱼座': 85 },
  '狮子座': { '白羊座': 70, '金牛座': 75, '双子座': 85, '巨蟹座': 70, '狮子座': 65, '处女座': 70, '天秤座': 85, '天蝎座': 75, '射手座': 80, '摩羯座': 70, '水瓶座': 80, '双鱼座': 70 },
  '处女座': { '白羊座': 80, '金牛座': 95, '双子座': 70, '巨蟹座': 85, '狮子座': 70, '处女座': 80, '天秤座': 75, '天蝎座': 85, '射手座': 60, '摩羯座': 95, '水瓶座': 70, '双鱼座': 80 },
  '天秤座': { '白羊座': 90, '金牛座': 85, '双子座': 90, '巨蟹座': 75, '狮子座': 85, '处女座': 75, '天秤座': 80, '天蝎座': 70, '射手座': 85, '摩羯座': 75, '水瓶座': 90, '双鱼座': 80 },
  '天蝎座': { '白羊座': 75, '金牛座': 80, '双子座': 65, '巨蟹座': 90, '狮子座': 75, '处女座': 85, '天秤座': 70, '天蝎座': 85, '射手座': 65, '摩羯座': 90, '水瓶座': 70, '双鱼座': 90 },
  '射手座': { '白羊座': 85, '金牛座': 60, '双子座': 80, '巨蟹座': 55, '狮子座': 80, '处女座': 60, '天秤座': 85, '天蝎座': 65, '射手座': 75, '摩羯座': 65, '水瓶座': 85, '双鱼座': 70 },
  '摩羯座': { '白羊座': 85, '金牛座': 90, '双子座': 60, '巨蟹座': 80, '狮子座': 70, '处女座': 95, '天秤座': 75, '天蝎座': 90, '射手座': 65, '摩羯座': 85, '水瓶座': 70, '双鱼座': 80 },
  '水瓶座': { '白羊座': 80, '金牛座': 55, '双子座': 95, '巨蟹座': 65, '狮子座': 80, '处女座': 70, '天秤座': 90, '天蝎座': 70, '射手座': 85, '摩羯座': 70, '水瓶座': 85, '双鱼座': 75 },
  '双鱼座': { '白羊座': 70, '金牛座': 75, '双子座': 65, '巨蟹座': 85, '狮子座': 70, '处女座': 80, '天秤座': 80, '天蝎座': 90, '射手座': 70, '摩羯座': 80, '水瓶座': 75, '双鱼座': 80 }
}

export function calculateZodiacMatch(sign1: string, sign2: string) {
  const loveIndex = loveCompatibility[sign1]?.[sign2] || 50
  const workIndex = workCompatibility[sign1]?.[sign2] || 50
  
  const element1 = zodiacSigns[sign1 as keyof typeof zodiacSigns]?.element
  const element2 = zodiacSigns[sign2 as keyof typeof zodiacSigns]?.element
  
  let description = `${sign1}与${sign2}的配对分析：\n\n`
  
  if (loveIndex >= 80) {
    description += '💕 爱情指数：天作之合，感情深厚稳定\n'
  } else if (loveIndex >= 60) {
    description += '💝 爱情指数：相处和谐，需要互相理解\n'
  } else {
    description += '💔 爱情指数：需要更多沟通和包容\n'
  }
  
  if (workIndex >= 80) {
    description += '🤝 工作指数：默契十足，合作无间\n'
  } else if (workIndex >= 60) {
    description += '👥 工作指数：各有所长，能够互补\n'
  } else {
    description += '⚖️ 工作指数：需要明确分工，避免冲突\n'
  }
  
  description += `\n元素搭配：${element1} × ${element2}`
  
  return {
    loveIndex,
    workIndex,
    description
  }
}